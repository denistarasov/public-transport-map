# public-transport-map

**Тарасов Денис Вадимович, группа БПМИ-155, тема "Схема общественного транспорта для Санкт-Петербурга"**

Ссылка на сайт: http://denistarasov.github.io/public-transport-map/

### Для запуска:
Скопировать репозиторий. Теперь можно сразу открыть index.html. Также можно вновь собрать данные, последовательно выполняя команды:
`nodejs parser.js`
`nodejs transform.js`

Затем запустить локальный сервер: `npm run dev` и открыть `http://127.0.0.1:8080` (или какой адрес выдаст предыдущая компанда) в браузере. Или же открыть ссылку из шапки: http://denistarasov.github.io/public-transport-map/

### Что сделано:
Создан скрипт для сбора и трансформации данных, собраны сами данные, реализована визуализация маршрутов, а также возможность покрасить отдельные маршруты, выбрать другие маркеры для остановок.

### Архитектура:
- `parser.js`: парсинг данных с сайта Петербургского транспорта и складирование их в папке `rawdata`
- `transform.js`: преобразование данных из `rawdata` для последующего отображения (складываем в папку `routes`)
- собственно, сам сайт и вспомогательные файлы `leaflet.js`, `index.html`, `styles.css` и др.
- данные в папках `routes` и `rawdata`

#### PARSER
Берем данные отсюда http://transport.orgp.spb.ru/Portal/transport/routes
Ссылки на маршруты (визуально -- лупа на зеленом фоне).
Смотрим, как страница получает список маршрутов.
Получает она их из http://transport.orgp.spb.ru/Portal/transport/routes/list
Как получали: нажимаем на F12 в хроме -> смотрим на вкладку 'Network' -> XHR -> list -> Headers -> From Data.
Загружаем Form Data в Postman и пробуем повторить запрос, попутно убирая ненужные параметры и пытаясь за раз получить весь доступный транспорт (на момент создания проекта, всего маршрутов было 465), для получения всех маршрутов увеличим параметр 'iDisplayLength' до 1000.
Получилось. Теперь повторяем это в JS. Для этого у Postman'а есть удобная кнопка Code, которая позволяет преобразовать строку с параметрами и др. сразу в код. В моем случае пользуемся модулем requests.
В итоге в файл `${transport_type}_routes.json` записаны маршруты соответствующего вида транспорта.

Теперь вычленим из них id маршрутов и запросим информацию о каждом из них.

#### TRANSFORM
Получаем имена всех фалов в папке (имя -- это номер маршрута) и сохраняем их сожержимое в один большой массив.
Теперь складываем все данные по шаблону: сначала все маршруты, состоящие из остановок, потом, собственно, сами остановки.
Попутно меняем метры на широту и долготу.
Записываем все это в `data.json`.

#### index.html
Теперь визуализируем все это с помощью библиотеки leaflet.

### Причины
Не самая удобная карта на официальном сайте транспорта Петербурга + желание научиться визуализировать схемы самостоятельно.

### Послесловие

В целом проект был сделан, но все же далек от первоначальной задумки быть действительно полноценной схемой транспорта. Как это обычно бывает, сначала все кажется легко, а потом довольно много времени тратится на поиск ответов на stackoverflow. Плюс очень важно заранее распланировать всю архитектуру проекта. Но сделать это, когда не сильно знаком ни с языком, ни с темой довольно сложно, видимо это приходит с опытом. Плюс лень является большой преградой на пути к совершенству, но я над этим работаю.